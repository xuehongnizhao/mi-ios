
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<title>Insert title here</title>
<script src="js/include.js"></script>
<link rel="stylesheet" href="css/basestyle.css">
<link>
<style type="text/css">
.am-header .am-header-title {
margin: 0 15%;
}

.mi-black {
	color: white;
	background: #968976;
	outline: none;
	border: #968976 1px solid;
	
}

.bk {
	border-bottom: 1px solid #eeeeee;
}

.row_height {
	height: 3.6em;
	line-height: 3.6em;
}

.honor, .item {
	padding-left: 1em;
	padding-right: 1em;
	padding-bottom: 0.5em;
}

.bcolor {
	background-color: #ffffff;
}

label {
	
}

.am-form-group {
	margin-bottom: 0em;
	padding-top: 0.0em;
	padding-bottom: 0.0em;
	background: white;
	padding-bottom: 0.0em;
	line-height: 2.5em;
	border-color: transparent;
	
}

.am-form-group .am-u-sm-9 {
	margin: 0em;
	padding:0.5em 0;
}

.am-form-group .am-u-sm-3 {
	padding-left: 0.5em;
	padding-right: 0em;
	padding-top: 0.5em;
	padding-bottom:0.5em; 
}

.am-form-group .am-u-sm-3 input {
	border: none;
	outline: none;
}

.am-form-group .am-u-sm-3 input[readonly] {
	background-color: white;
}

.am-form-group .am-u-sm-9 input {
	border: 0px;
	outline: none;
	padding-left: 0em;
	border-color: #aaaaaa;
}

.am-form-group .am-u-sm-9 input:focus {
	-webkit-box-shadow: none;
	box-shadow: none;
}

.am-form-group  textarea:focus {
	-webkit-box-shadow: none;
	box-shadow: none;
}

.am-form-group .am-u-sm-9 input[readonly] {
	background-color: white;
}

hr {
	margin: 0em;
	padding: 0em;
	border-top: 1px solid #dddddd;
}

.hr-left {
	margin-left: 1em;
}
body, html {
	width: 100%;
	height: 100%;
	background-image: url('img/mi_bg.png');
	background-size: cover;
	background-repeat: no-repeat;
}
</style>
</head>
<body style="" >

	<!-- Header -->
	<header data-am-widget="header" style=""
		class="am-header am-header-default am-header-fixed mi-title">
		<div class="am-header-left am-header-nav">
			<a href="javascript:mi_exit(-1);" style="text-align: left"> <i
				class="am-icon-angle-left" style="font-size: 2em;"></i>
			</a>
		</div>
		<h1 class="am-header-title"
			style="font-size: 18px; text-align: left; margin: 0 10%;">修改密码</h1>
	</header>

	<div style="background:white">
		<div class="am-form-group am-g " style="border:none;background-color: #fbfef1" >
			<div class="am-u-sm-3"   >
				<input type="text" value="&nbsp;原&nbsp;密&nbsp;码" style="height: 2em;
    line-height: 1em;width: 100%;color: #72777a;background-color: #fbfef1" readonly>
			</div>
			<div class="am-u-sm-9">
				<input type="password" id="oldpwd" name="oldpwd" style="height: 2em;
    line-height: 2em;background-color: #fbfef1" placeholder="请输入原始密码">
			</div>
		</div>
		<hr class="hr-left">
		<div class="am-form-group am-g" style="background-color: #fbfef1">
			<div class="am-u-sm-3" >
				<input type="text" value="&nbsp;新&nbsp;密&nbsp;码" style="height: 2em;
    line-height: 2em;width: 100%;color: #72777a;background-color: #fbfef1" readonly>
			</div>
			<div class="am-u-sm-9">
				<input type="password" id="newpwd" name="newpwd" style="height: 2em;
    line-height: 2em;background-color: #fbfef1 "placeholder="请输入新密码">
			</div>
		</div>
		<hr class="hr-left">
		<div class="am-form-group am-g" style="background-color: #fbfef1">
			<div class="am-u-sm-3" >
				<input type="text" value="&nbsp;确认密码" style="height: 2em;
    line-height: 2em;width: 100%;color: #72777a;background-color: #fbfef1" readonly >
			</div>
			<div class="am-u-sm-9">
				<input type="password" id="conpwd" name="conpwd" style="height: 2em;
    line-height: 2em;background-color: #fbfef1 " placeholder="请确认新密码">
			</div>
		</div>
		<div class="am-form-group " >
			<div class="" align="center" >
				<button onclick="modifypassword()" class=" mi-black"
					style="width: 100%; height: 50px;background-color: #fe9a0f;border: none;">保存修改</button>
			</div>
		</div>
	</div>

	<div class="am-modal-actions" id="input_xb">
		<div class="am-modal-actions-group">
			<ul class="am-list">
				<li val="男" data-am-modal-confirm><span>男</span></li>
				<li val="女" data-am-modal-confirm><span>女</span></li>
				<li><button class="am-btn am-btn-secondary am-btn-block"
						data-am-modal-cancel>取消</button></li>
			</ul>
		</div>
	</div>
	<div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
		<div class="am-modal-dialog">
			<div class="am-modal-hd">错误</div>
			<div class="am-modal-bd">
				<a id="errmsg"></a>
			</div>
			<div class="am-modal-footer">
				<span class="am-modal-btn">确定</span>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var userid = window.localStorage.getItem('userid');

	function modifypassword() {
		var oldpwd = $('#oldpwd').val();
		var newpwd = $('#newpwd').val();
		var conpwd = $('#conpwd').val();

		if (oldpwd == "") {
			$('#errmsg').text("请输入原密码");
			$('#my-alert').modal();
			return;
		}
		if (newpwd == "") {
			$('#errmsg').text("请输入新密码");
			$('#my-alert').modal();
			return;
		}
		if (conpwd == "") {
			$('#errmsg').text("请输入确认密码");
			$('#my-alert').modal();
			return;
		}
		if (conpwd != newpwd) {
			$('#errmsg').text("新密码与确认密码不一致");
			$('#my-alert').modal();
			return;
		}
		if (newpwd.length < 6) {
			$('#errmsg').text("密码不能少于6位");
			$('#my-alert').modal();
			return;
		}

		$.ajax({
			type : "post",
			url : url("User.modifyPassword"),
			data : {
				"userid" : encodeURIComponent(userid),
				"oldpwd" : encodeURIComponent(oldpwd),
				"newpwd" : encodeURIComponent(newpwd)
			},
			dataType : "jsonp",
			jsonp : "callback",
			jsonpCallback : "cb",
			success : function(data) {
				if (data.ret == "2") {
					$('#errmsg').text("未知错误，请重试");
					$('#my-alert').modal();
				
				} else if (data.ret == "1") {
					$('#errmsg').text("密码不正确，请重新输入");
					$('#my-alert').modal();
				} else {
					window.history.back();
				}

			},
			error : function() {
				$('#errmsg').text("网络通讯错误,请稍后重试");
				$('#my-alert').modal();

			}

		});

	}
</script>
</html>